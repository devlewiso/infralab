# Production-Grade Homelab Infrastructure

> A private on-premise infrastructure designed to experiment, validate, and operate production-grade architectures for AI, DevOps, and secure access.

---

## ğŸ¯ Project Overview

This is not a hobby projectâ€”it's a **production-grade infrastructure lab** that demonstrates real-world systems engineering, operational excellence, and architectural depth. Every component is chosen deliberately, every boot sequence is orchestrated, and every failure scenario is planned for.

### Key Metrics

| Metric | Target | Description |
|--------|--------|-------------|
| Uptime | 99.9% | Service availability goal |
| MTTR | < 5 min | Mean Time to Recovery |
| Layers | 4 | Orchestrated boot sequence |
| Services | 13 | Total managed containers |

---

## ğŸŒ Network Infrastructure

### ISP & WAN

| Component | Model | Description |
|-----------|-------|-------------|
| **ISP** | Starlink Mini | Satellite internet connection |
| **Speed** | 1000FDX | Full-duplex gigabit |

### TP-Link Omada Network Stack

```
Internet (Starlink Mini)
        â”‚
        â–¼ 1000FDX
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ER605 Router     â”‚ MAC: 1C-61-B4-2C-1B-E3
â”‚  WAN1             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Port #5 â†’ Port #1
         â–¼ 1000FDX
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cerebro          â”‚ TP-Link SG3428
â”‚  (Main Switch)    â”‚ 28-Port Managed
â””â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
 â”‚      â”‚       â”‚
 â”‚      â”‚       â””â”€â”€â”€â”€â”€â”€â–º Port #4: Omada Controller
 â”‚      â”‚
 â”‚      â””â”€â”€â–º Port #24: Antenitas (EAP225-Outdoor)
 â”‚                      â”œâ”€â”€ WiFi: 6(b/g/n), 36(a/n/ac)
 â”‚                      â”œâ”€â”€ Client Group 6 (WiFi)
 â”‚                      â””â”€â”€ Camera Group 4 (WiFi)
 â”‚
 â””â”€â”€â”€â”€â”€â”€â–º Client Group 7 (Wired)
```

### Network Equipment

| Device | Model | Role | Port |
|--------|-------|------|------|
| **Router** | TP-Link ER605 | WAN Gateway | WAN1 |
| **Switch** | TP-Link SG3428 (Cerebro) | Core Switch | 28 ports |
| **Controller** | Omada Controller | Network Management | Port #4 |
| **Access Point** | EAP225-Outdoor (Antenitas) | Wireless | Port #24 |

### Client Groups

| Group | Count | Connection | Description |
|-------|-------|------------|-------------|
| Client Group 7 | 7 devices | Wired (Cerebro) | LAN clients |
| Client Group 6 | 6 devices | WiFi (Antenitas) | Wireless clients |
| Camera Group 4 | 4 devices | WiFi (Antenitas) | Security cameras |

---

## ğŸ—ï¸ Core Architecture: Layered Boot Sequence

The infrastructure follows a **strict boot orchestration pattern** where each layer depends on the previous one to ensure proper service initialization and dependency resolution.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ–¥ï¸ Proxmox Host                          â”‚
â”‚                      (nosotros)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¥‡ LAYER 1: Infra Base (Foundation)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ CT 101      â”‚ â”‚ CT 102      â”‚ â”‚ CT 120      â”‚           â”‚
â”‚  â”‚ Omada21     â”‚ â”‚ Twingate   â”‚ â”‚ Monitoring30â”‚           â”‚
â”‚  â”‚ Network     â”‚ â”‚ Zero Trust â”‚ â”‚ Observabilityâ”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ depends on
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¥ˆ LAYER 2: Servicios Core (Data & Backend)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ CT 159      â”‚ â”‚ CT 155      â”‚ â”‚ CT 124      â”‚           â”‚
â”‚  â”‚ PostgreSQL  â”‚ â”‚ NodeBB     â”‚ â”‚ DevOps Lab  â”‚           â”‚
â”‚  â”‚ Database    â”‚ â”‚ Forum      â”‚ â”‚ CI/CD       â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ depends on
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¥‰ LAYER 3: Apps / Web (Application Layer)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ CT 122      â”‚ â”‚ CT 243      â”‚ â”‚ CT 289      â”‚           â”‚
â”‚  â”‚ Web-Lab22   â”‚ â”‚ Ollama     â”‚ â”‚ Ridemotohubâ”‚            â”‚
â”‚  â”‚ Web Servicesâ”‚ â”‚ AI/LLM     â”‚ â”‚ App Platformâ”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ depends on
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŸ¦ LAYER 4: Usuario / Media (User Facing)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ CT 100      â”‚ â”‚ CT 200      â”‚ â”‚ CT 104      â”‚           â”‚
â”‚  â”‚ CasaOS      â”‚ â”‚ Home       â”‚ â”‚ NVR69       â”‚           â”‚
â”‚  â”‚ Media Serverâ”‚ â”‚ Assistant  â”‚ â”‚ Surveillanceâ”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ Service Registry

### Layer 1: Infra Base (Foundation)

> **Purpose:** Foundation layer ensuring secure access, network control, and base monitoring before any application services start.

| CT ID | Name | Description | Status |
|-------|------|-------------|--------|
| 101 | Omada21 Network Controller | TP-Link Omada network management | ğŸŸ¢ Active |
| 102 | twingate-connector | Zero Trust Access gateway | ğŸŸ¢ Active |
| 120 | Monitoring30 | Infrastructure observability (Prometheus/Grafana) | ğŸŸ¢ Active |

### Layer 2: Servicios Core (Data & Backend)

> **Purpose:** Core services and data layer. Databases and backend systems that applications depend on.

| CT ID | Name | Description | Status |
|-------|------|-------------|--------|
| 159 | dbEmpleosdelatlantico | PostgreSQL Database | ğŸŸ¢ Active |
| 155 | nodebb Forum Backend | Community platform backend | ğŸŸ¢ Active |
| 124 | devops-lab | Development and CI/CD environment | ğŸŸ¢ Active |

### Layer 3: Apps / Web (Application Layer)

> **Purpose:** Application layer serving web services, AI workloads, and custom platforms to end users.

| CT ID | Name | Description | Status |
|-------|------|-------------|--------|
| 122 | web-lab22 | Web Services & Application Frontend | ğŸŸ¢ Active |
| 243 | ollamaServer | Local AI/LLM Inference (Privacy-first) | ğŸŸ¢ Active |
| 289 | ridemotohub | Custom Application Platform | ğŸŸ¢ Active |

### Layer 4: Usuario / Media (User Facing)

> **Purpose:** User-facing services for media consumption, home automation, and physical security monitoring.

| CT ID | Name | Description | Status |
|-------|------|-------------|--------|
| 100 | CasaOSMedia105 | Media Server | ğŸŸ¢ Active |
| 200 | homeassistant119 | Home Automation | ğŸŸ¢ Active |
| 104 | NVR69 | Video Surveillance System | ğŸŸ¢ Active |

---

## ğŸ” Security Architecture

### Zero-Trust Access

```
External Users
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Twingate      â”‚ â—„â”€â”€ Zero Trust Network Access
â”‚   Connector     â”‚     (No VPN, Identity-based)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VLAN          â”‚ â—„â”€â”€ Network Segmentation
â”‚   Segmentation  â”‚     (Isolated traffic)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Firewall      â”‚ â—„â”€â”€ pfSense Rules
â”‚   Rules         â”‚     (Controlled access)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    Internal Services
```

### Security Layers

| Layer | Technology | Purpose |
|-------|------------|---------|
| **Access** | Twingate | Zero Trust remote access |
| **Network** | VLANs | Traffic segmentation |
| **Perimeter** | pfSense | Firewall & gateway |
| **Monitoring** | Prometheus/Grafana | Anomaly detection |
| **Backup** | Automated | Data protection |

---

## ğŸš€ Key Capabilities

### 1. Zero-Trust Architecture
- Twingate-based secure remote access
- Network segmentation with VLANs
- Controlled firewalls and access policies
- No traditional VPN required

### 2. Local AI Inference
- Self-hosted LLM stack (Ollama, LLaMA)
- Privacy-first AI workloads
- No cloud dependencies
- Full data sovereignty

### 3. Full Observability
- Real-time monitoring (Prometheus)
- Visual dashboards (Grafana)
- Alerting and incident response
- MTTR tracking and SLO management

### 4. Orchestrated Boot
- Layered startup sequence
- Dependency resolution
- Graceful failure handling
- Automated recovery via Proxmox API

---

## ğŸ› ï¸ Technical Stack

### Infrastructure

| Component | Technology |
|-----------|------------|
| Hypervisor | Proxmox VE |
| Containers | LXC |
| Virtual Machines | KVM |
| Storage | ZFS (RAID-Z) |

### Networking

| Component | Technology |
|-----------|------------|
| Router | TP-Link ER605 |
| Switch | TP-Link SG3428 |
| Controller | Omada Controller |
| Access Point | EAP225-Outdoor |
| Zero Trust | Twingate |
| Gateway | pfSense |
| DNS | Internal DNS Server |

### Operations

| Component | Technology |
|-----------|------------|
| Monitoring | Prometheus |
| Dashboards | Grafana |
| Backups | Automated (ZFS snapshots) |
| Orchestration | Proxmox API + Systemd |

---

## âš™ï¸ Architecture Insights & Constraints

### Isolation Strategy
- **CT vs VM decisions** based on isolation requirements and resource efficiency
- Containers for lightweight services
- VMs for workloads requiring full isolation

### Storage Coordination
- Precise timing for network-mounted volumes
- Boot dependencies properly ordered
- ZFS snapshots for point-in-time recovery

### Infrastructure Services
- DNS resolution available before app startup
- NTP synchronization at infrastructure layer
- Critical services in Layer 1 boot first

### Performance Optimization
- MTU optimization (Jumbo frames where applicable)
- Network bridge configuration
- VLAN tagging for traffic segregation

### Reliability Guarantees
- Controlled shutdown procedures
- Graceful recovery mechanisms
- Zero-data-loss guarantees via ZFS
- Automated health checks

---

## ğŸ“Š Operational Runbooks

### Boot Sequence
```bash
# Automatic via Proxmox API
Layer 1 â†’ Wait for health â†’ Layer 2 â†’ Wait â†’ Layer 3 â†’ Wait â†’ Layer 4
```

### Shutdown Sequence
```bash
# Reverse order with graceful stops
Layer 4 â†’ Layer 3 â†’ Layer 2 â†’ Layer 1
```

### Recovery Procedure
1. Check Proxmox host status
2. Verify network connectivity (Starlink)
3. Start Layer 1 services
4. Wait for health checks
5. Proceed to next layer
6. Validate all services

---

## ğŸ“ Notes

- **Last Updated:** December 2024
- **Maintainer:** Infrastructure Team
- **Documentation:** [infra.neuralcodelab.com](https://infra.neuralcodelab.com)

---

*This documentation is auto-generated and maintained as part of the infrastructure-as-code practices.*
